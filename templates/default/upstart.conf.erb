# <%= @app_name %>.conf
# This file is generated by Chef for <%= node[:fqdn] %>

description "<%= @app_name %>"

start on filesystem or runlevel [2345]
stop on runlevel [06]
expect fork

respawn
respawn limit 5 30

pre-start script   
  echo "[`date -u +%Y-%m-%dT%T.%3NZ`] (upstart) Starting" >> <%= @logfile %>
end script

pre-stop script
  rm /var/run/<%= @app_name %>.pid
  echo "[`date -u +%Y-%m-%dT%T.%3NZ`] (upstart) Stopping" >> <%= @logfile %>
end script

script
  echo $$ > /var/run/<%= @app_name %>.pid
  chdir <%= @path %>
  exec sudo -u <%= @username %> \
    NODE_ENV=<%= @node_env %> \
    npm start >> <%= @logfile %> 2>&1
end script
